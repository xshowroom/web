/*! xshowroom - v1.0.0 - 2016-01-15 */angular.module("xShowroom.register.buyer",["xShowroom.i18n","xShowroom.directives","xShowroom.services","ui.uploader"]).controller("RegisterBuyerCtrl",["$scope","$element","$filter","$q","$modal","User","Country",function(a,b,c,d,e,f,g){a.step={stepNumber:1,validation:{1:{email:!1,pass:!1,firstName:!1,lastName:!1,displayName:!1,tel:!1},2:{shopName:!1,shopType:!1,collectionType:!1,brandList:!1,shopWebsite:!1,shopAddress:!1,shopShipAddress:!1,shopCountry:!1,shopZipcode:!1,shopTel:!1,imagePath:!1},3:{companyName:!1,companyAddr:!1,companyCountry:!1,companyZip:!1,companyTel:!1,companyWebsite:!1,acceptCondition:!1}},reg:{1:{email:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,pass:/^\S{6,100}$/,firstName:/^\S{1,50}$/,lastName:/^\S{1,50}$/,tel:/^\S{6,20}$/},2:{shopWebsite:/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-@?^=%&amp;/~\+#])?/},3:{companyWebsite:/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-@?^=%&amp;/~\+#])?/}},duplication:{1:["email"],2:[],3:[]}},a.user={roleType:2},a.isRegistering=!1,a.setCollection=function(b){var c=a.user.collectionType?a.user.collectionType.split(","):[],d=c.indexOf(b);d>=0?c.splice(d,1):c.push(b),a.user.collectionType=c.join(",")},a.errorMsgs=[],a.check=function(){var b=a.step.stepNumber,c=a.step.validation[b];a.errorMsgs=[];var e=[];for(var g in c){var h=a.user[g];"shopWebsite"!=g||h?h&&""!=h?!a.step.reg[b][g]||a.step.reg[b][g].test(h)?(a.step.duplication[b].indexOf(g)>=0&&e.push(f.duplicationCheck({key:g,param:h})),a.step.validation[b][g]=!1):(a.errorMsgs.push([g,"PATTERN_ERROR"]),a.step.validation[b][g]=!0):(a.errorMsgs.push([g,"EMPTY_ERROR"]),a.step.validation[b][g]=!0):a.step.validation[b][g]=!1}d.all(e).then(function(){for(var c=0;c<arguments[0].length;c++){var d=arguments[0][c],e=d.config.data.key;d.data.status?(a.step.validation[b][e]=!0,a.errorMsgs.push([e,"DUPLICATION_ERROR"])):a.step.validation[b][e]=!1}!a.errorMsgs.length&&a.step.stepNumber<3?a.step.stepNumber+=1:a.errorMsgs.length||3!=a.step.stepNumber||a.register()})},a.previous=function(){a.step.stepNumber>1&&a.step.stepNumber<=3&&a.step.stepNumber--},a.countries=g.getAll(),a.register=function(){if(!a.isRegistering){a.isRegistering=!0;var b=f.register(a.user);b.success(function(b){a.isRegistering=!1,"object"!=typeof b||b.status?e({title:c("translate")("modal__title__ERROR"),content:b.msg,show:!0}):window.open("/buyer/dashboard","_self")})}},a.checkInvitation=function(){var a=angular.element("#invitation-code").val();f.invitationCheck({code:a,rnd:(new Date).getTime()}).success(function(a){a.status?$("#invite-modal").modal("hide"):$("#invite-error").show()})}}]);