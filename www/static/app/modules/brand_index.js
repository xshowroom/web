/*! xshowroom - v1.0.0 - 2016-01-15 */angular.module("xShowroom.brand.index",["xShowroom.i18n","xShowroom.directives","xShowroom.services","mgcrea.ngStrap"]).controller("BrandIndexCtrl",["$scope","$modal","$timeout","$filter","Brand","Buyer",function(a,b,c,d,e,f){a.selectSeason=function(b){a.selectedSeason=b,a.selectedCover=a.covers[b][0]},a.selectCover=function(b){a.selectedCover=b},a.selectStore=function(b){var c=a.selectedStores.indexOf(b);c>=0?a.selectedStores.splice(c,1):a.selectedStores.push(b)},a.refreshCovers=function(){a.seasons=[],e.getLookbookPhotos({brandId:a.brandOwner}).success(function(c){if("object"!=typeof c||c.status||!c.data)return void b({title:d("translate")("modal__title__ERROR"),content:c.msg,show:!0});a.seasons=[],a.covers={};for(var e=0,f=c.data.length;f>e;e++){var g=c.data[e];a.covers[g.season]||(a.seasons.push(g.season),a.covers[g.season]=[]),a.covers[g.season].push(g)}a.selectedSeason=a.seasons[0],a.selectedCover=a.covers[a.selectedSeason]?a.covers[a.selectedSeason][0]:null})},a.applyAuth=function(){for(var c=[],e=0,g=a.selectedStores.length;g>e;e++)c.push(a.selectedStores[e].id);f.applyAuth({shopIdList:c.join(","),brandId:a.brandId}).success(function(c){return"object"!=typeof c||c.status?void b({title:d("translate")("modal__title__ERROR"),content:c.msg,show:!0}):void(a.authCode=-1)}),$("#auth-store-modal").modal("hide")},a.setFilters=function(b,d){0==a.authCode&&(a.filterTimeout&&(c.cancel(a.filterTimeout),a.filterTimeout=null),a.filters[b]=d,a.filterTimeout=c(function(){a.refreshCollectionList(!0)},500,!0))},a.refreshCollectionList=function(c){a.collections.offset+=c?-a.collections.offset:a.collections.pageSize;var f=angular.copy(a.filters);f.pageSize=a.collections.pageSize,f.offset=a.collections.offset,f.brandId=a.brandId,f.season&&(f.season=f.season.join(",")),e.getCollectionList(f).success(function(e){if("object"!=typeof e||e.status)return void b({title:d("translate")("modal__title__ERROR"),content:e.msg,show:!0});if(c)a.collections.content=e.data;else for(var f=0,g=e.data.length;g>f;f++)a.collections.content.push(e.data[f]);a.hasNext=e.data.length==a.collections.pageSize})},a.parseImageUrl=function(a){var b=JSON.parse(a);return b[0]};var g=function(){return a.isGuest?void(a.authCode=-2):void f.checkAuth({brandId:a.brandId}).success(function(c){return"object"!=typeof c||c.status?void b({title:d("translate")("modal__title__ERROR"),content:c.msg,show:!0}):(a.authCode=c.data,void(0==c.data&&a.refreshCollectionList(!0)))})},h=function(){a.isGuest||f.getStoreList().success(function(c){return"object"!=typeof c||c.status?void b({title:d("translate")("modal__title__ERROR"),content:c.msg,show:!0}):(a.stores=c.data,void(a.selectedStore=null))})},i=function(){g(),h(),a.collections={pageSize:4,offset:0,content:[]},a.filters={},a.conditions=e.getIndexConditions(),a.selectedStores=[],a.refreshCovers()};i()}]);