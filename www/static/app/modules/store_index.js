/*! xshowroom - v1.0.0 - 2016-01-15 */angular.module("xShowroom.store.index",["xShowroom.i18n","xShowroom.directives","xShowroom.services","mgcrea.ngStrap","ui.uploader","ngTextcomplete"]).controller("StoreIndexCtrl",["$scope","$window","$location","$filter","Country","Store",function(a,b,c,d,e,f){a.isEditing=1==c.search().isEdit,a.setCollection=function(b){var c=a.store.collectionType?a.store.collectionType.split(","):[],d=c.indexOf(b);d>=0?c.splice(d,1):c.push(b),a.store.collectionType=c.join(",")},a.countries=e.getAll(),a.checkInfo={validation:{shopName:!1,shopType:!1,collectionType:!1,brandList:!1,shopWebsite:!1,shopAddress:!1,shopCountry:!1,shopZipcode:!1,shopShipAddress:!1,shopTel:!1},reg:{shopWebsite:/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-@?^=%&amp;/~\+#])?/}},a.addStoreImage=function(b){a.store.shopImage.push(b),a.$apply()},a.update=function(){a.errorMsgs=[];for(var c in a.checkInfo.validation){var d=a.store[c];"shopWebsite"!=c||d?d&&""!=d&&!angular.equals(d,{})?!a.checkInfo.reg[c]||a.checkInfo.reg[c].test(d)?a.checkInfo.validation[c]=!1:(a.errorMsgs.push([c,"PATTERN_ERROR"]),a.checkInfo.validation[c]=!0):(a.errorMsgs.push([c,"EMPTY_ERROR"]),a.checkInfo.validation[c]=!0):a.checkInfo.validation[c]=!1}a.errorMsgs.length||f.create(a.store).success(function(c){c.status?a.errorMsgs.push(["create error",c.msg]):b.open("/buyer/store","_self")})},a.toggleEditing=function(){a.isEditing=!a.isEditing};var g=function(){f.findOne({shopId:a.storeId}).success(function(b){if("object"!=typeof b||b.status)return void $modal({title:d("translate")("modal__title__ERROR"),content:b.msg,show:!0});a.store={shopId:b.data.id,shopName:b.data.name,shopType:b.data.type,collectionType:b.data.collection_type,brandList:b.data.brand_list,shopWebsite:b.data.website,shopAddress:b.data.address,shopCountry:b.data.country,shopZipcode:b.data.zip,shopTel:b.data.telephone,shopImage:b.data.image?JSON.parse(b.data.image):[],shopAbout:b.data.about,shopShipAddress:b.data.ship_address},a.collectionType={};for(var c=b.data.collection_type.split(","),e=0,f=c.length;f>e;e++)a.collectionType[c[e]]=!0})};g()}]);