/*! xshowroom - v1.0.0 - 2016-01-15 */angular.module("xShowroom.product.create",["xShowroom.i18n","xShowroom.directives","xShowroom.services","mgcrea.ngStrap","ui.uploader","ngTextcomplete"]).controller("ProductCreateCtrl",["$scope","$location","$window","$filter","$modal","$element","$timeout","Country","Product","uiUploader",function(a,b,c,d,e,f,g,h,i,j){a.countries=h.getAll(),a.categories=i.getCategoriesByCollection(a.collectionCategory),a.sizeRegions=i.getSizeRegions(),a.product={collectionId:a.collectionId,images:[]},a.addProductImage=function(b){a.product.images.push(b),a.$apply()},a.setSizeCodes=function(b,c){b&&c&&(a.sizeCode=i.getSizeCodes(b,c),a.product.sizeCode={})},a.openColorModal=function(){angular.element("#color-modal").modal("show")},a.currentColors={standard:{},customized:[]},a.standardColors={white:"#fff","off white":"#f4f1ea",beige:"#f5f5dc",grey:"#939393",black:"#000",red:"#fe0000",yellow:"#f6e911",blue:"#000fff",green:"#31c857",purple:"#7d26cd",navy:"#191970",earth:"#D2B48C",pink:"#ffb5c5",brown:"#5E2612",neutrals:"#eecbad","yellow gold":"#dfc32d","rose gold":"#e7c6ba",silver:"#b6b1b1",bronze:"#a98633",orange:"#f29c00"},f.on("change","#color-file",function(b){a.$emit("uploading.start");var c=$(this),d=b.target.files;if(!d.length)return void a.$emit("uploading.end");var e={index:-1};a.colorErrorMsg=[];var f=g(function(){f=null},3e4,!0);return/image\/\w+/.test(d[0].type)?d[0].size/1024/1024>1?(e.msg="size_error",a.colorErrorMsg.push(e),a.$apply(),c.val(""),void a.$emit("uploading.end")):(j.removeAll(),j.addFiles(d),j.startUpload({url:"/api/upload/image",onCompleted:function(b,c){return f?(c=JSON.parse(c),0!=c.status?(e.msg="response_error",a.colorErrorMsg.push(e),a.$apply(),void a.$emit("uploading.end")):(a.currentColors.customized.push({name:void 0,value:c.data,type:"url",style:"background-image: url(/"+c.data+");",selected:!0}),a.$apply(),a.$emit("uploading.end"),g.cancel(f),void(f=null))):(e.msg="timeout_error",a.colorErrorMsg.push(e),a.$apply(),void a.$emit("uploading.end"))}}),void c.val("")):(e.msg="format_error",a.colorErrorMsg.push(e),a.$apply(),c.val(""),void a.$emit("uploading.end"))}),a.removeCustomizedColor=function(b){a.currentColors.customized.splice(b,1);for(var c=0,d=a.colorErrorMsg.length;d>c;c++)a.colorErrorMsg[c].index==b&&a.colorErrorMsg.splice(c--,1)},a.setColor=function(){var b=[];a.colorErrorMsg=[];for(var c in a.currentColors.standard)a.currentColors.standard[c]&&b.push({name:c,value:a.currentColors.standard[c],type:0});for(var d=0,e=a.currentColors.customized.length;e>d;d++){var f=a.currentColors.customized[d];f.selected&&f.name?b.push({name:f.name,value:f.value,type:1}):a.colorErrorMsg.push({index:d,msg:"unnamed_error"})}a.colorErrorMsg.length||(a.product.color=b,angular.element("#color-modal").modal("hide"))},a.checkInfo={validation:{name:!1,category:!1,styleNum:!1,wholePrice:!1,retailPrice:!1,sizeRegion:!1,sizeCode:!1,color:!1,madeIn:!1,material:!1,careIns:!1,images:!1},reg:{wholePrice:/^(0|[1-9][0-9]*)(\.?\d{0,2})?$/,retailPrice:/^(0|[1-9][0-9]*)(\.?\d{0,2})?$/}},a.create=function(){a.errorMsgs=[];for(var b in a.checkInfo.validation){var f=a.product[b];f&&""!=f&&!angular.equals(f,{})?!a.checkInfo.reg[b]||a.checkInfo.reg[b].test(f)?a.checkInfo.validation[b]=!1:(a.errorMsgs.push([b,"PATTERN_ERROR"]),a.checkInfo.validation[b]=!0):(a.errorMsgs.push([b,"EMPTY_ERROR"]),a.checkInfo.validation[b]=!0)}a.errorMsgs.length||i.create(a.product).success(function(b){"object"!=typeof b||b.status?e({title:d("translate")("modal__title__ERROR"),content:b.msg,show:!0}):c.open("/collection/"+a.collectionId,"_self")})}}]);