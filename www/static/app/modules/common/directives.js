/*! xshowroom - v1.0.0 - 2016-01-15 */angular.module("xShowroom.directives",["ngCookies","mgcrea.ngStrap","xShowroom.i18n","xShowroom.services","ui.uploader"]).config(["$cookiesProvider",function(a){var b=6048e5,c=new Date((new Date).getTime()+b);a.defaults.expires=c,a.defaults.path="/"}]).directive("localeSettings",["$cookies",function(a){return{template:function(a,b,c){var d=['<div class="dropdown">','<a id="locale-setting-language" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',"{{ language }}",'<span class="caret"></span>',"</a>",'<ul class="dropdown-menu" aria-labelledby="locale-setting-language">',"<li ng-click=\"setLanguage('en')\">English</li>","<li ng-click=\"setLanguage('zh_CN')\">简体中文</li>","</ul>","</div>"].join("");return d},transclude:!0,restrict:"C",replace:!1,link:function(b,c,d,e){var f={en:"ENGLISH",zh_CN:"简体中文"};b.language=f[a.get("language")],c.find(".dropdown-toggle").dropdown(),b.setLanguage=function(b){a.put("language",b),window.location.reload()}}}}]).directive("filterCondition",[function(){return{template:function(a,b,c){var d=['<div class="col-xs-12">','<div class="filter-header">','<span class="filter-name">{{("filter_title__" + (title|uppercase))|translate}}</span>','<span class="filter-clear-all" ng-click="clearAll()" ng-if="hasClearAll && selectedConditions.length">{{"filter__CLEAR_ALL" | translate}}</span>',"</div>","</div>",'<ul class="col-xs-12 filter-list filter-{{type}}-list">','<li ng-repeat="item in conditions | limitTo: limit" ng-click="toggle(item)" ng-class="{\'active\': isActive(item)}">','<span class="filter-selector glyphicon" ng-class="{\'glyphicon-ok\': isActive(item)}"></span>',"<span>{{item | translate}}</span>","</li>","</ul>",'<span class="col-xs-12 filter-more" ng-click="showMore()" ng-if="limit < conditions.length">{{"filter__SHOW_MORE" | translate}}</span>'].join("");return d},scope:{title:"@",conditions:"=",type:"@",selected:"&",hasClearAll:"@"},transclude:!0,restrict:"C",replace:!1,link:function(a,b,c,d){a.selectedConditions=[],a.toggle=function(b){if("checkbox"==a.type){var c=a.selectedConditions.indexOf(b);-1==c?a.selectedConditions.push(b):a.selectedConditions.splice(c,1)}else"radio"==a.type&&(a.selectedConditions[0]=b);a.selected({name:a.title.split(),conditions:a.selectedConditions})},a.clearAll=function(){a.selectedConditions=[],a.selected({name:a.title,conditions:a.selectedConditions})},a.limit=4,a.isActive=function(b){return a.selectedConditions.indexOf(b)>=0},a.showMore=function(){a.limit+=4}}}}]).directive("imageUploader",["uiUploader","$modal","$location","$timeout",function(a,b,c,d){return{template:["<div>",'<img ng-src="/{{imageOnlineUrl}}" class="uploaded-image">','<label for="{{imageId}}">','<span>{{"directives_js__UPLOAD" | translate}}</span>','<span ng-if="title">{{title}}</span>','<span>({{"directives_js__FILE_SIZE" | translate}})</span>','<input id="{{imageId}}" type="file">',"</label>","</div>"].join(""),transclude:!1,restrict:"C",replace:!0,scope:{title:"@",targetModel:"=",renderImage:"@",afterUploading:"&",imageOnlineUrl:"="},controller:function(e,f,g,h){e.imageId=[(new Date).getTime(),Math.round(1e3*Math.random())].join("");c.protocol()+"://"+c.host()+":"+c.port()+"/";e.timeout=null;var i=function(c){a.removeAll(),a.addFiles(c),a.startUpload({url:"/api/upload/image",onCompleted:function(a,c){return e.timeout?(c=JSON.parse(c),0!=c.status?(b({title:"Error Info",content:"上传图片接口出错，请重新上传，如多次失败请联系我们！",show:!0}),void e.$emit("uploading.end")):(0!==parseInt(g.renderImage)&&(e.imageOnlineUrl=c.data),g.targetModel&&(e.targetModel=c.data,e.$apply()),e.afterUploading({url:c.data}),e.$emit("uploading.end"),d.cancel(e.timeout),void(e.timeout=null))):(b({title:"Error Info",content:"上传图片超时，请重新上传！",show:!0}),void e.$emit("uploading.end"))}})};$(f).on("change","#"+e.imageId,function(a){e.$emit("uploading.start");var c=$(this),f=a.target.files;if(f.length){if(!/image\/\w+/.test(f[0].type))return b({title:"Error Info",content:"上传文件类型必须为图片！",show:!0}),c.val(""),void e.$emit("uploading.end");if(f[0].size/1024/1024>2)return b({title:"Error Info",content:"上传文件大于5MB！",show:!0}),c.val(""),void e.$emit("uploading.end");e.timeout=d(function(){e.timeout=null},3e4,!0),e.$apply(),i(f),c.val("")}})}}}]).directive("uploading",["$filter",function(a){return{transclude:!1,restrict:"C",replace:!1,link:function(b,c,d,e){b.$on("uploading.start",function(){var b=['<div class="uploading-mask">','<div class="uploading-content">','<span class="glyphicon glyphicon-arrow-up"></span>',"<span>"+a("translate")("directives_js__UPLOADING")+"</span>","</div>","</div>"].join("");c.append(b)}),b.$on("uploading.end",function(){c.find(".uploading-mask").remove()})}}}]).directive("imageLink",[function(){return{transclude:!1,restrict:"C",replace:!1,link:function(a,b,c,d){b.on("mouseenter",function(){var a=$(this).children("img").attr("src"),d=['<div class="image-link-mask" style="background-image: url('+a+');">'];d="false"===c.hasButton?d.concat(["<div>",'<a class="text-link" href="'+c.href+'" target="'+(c.target||"_self")+'">','<i class="fa fa-quote-left pull-left"></i>',"<p>"+c.content+"</p>",'<i class="fa fa-quote-right pull-right"></i>','<div class="clearfix"></div>',"</a>","</div>"]):c.content?d.concat(["<div>",'<a class="text-link" href="'+c.href+'" target="'+(c.target||"_self")+'">','<div class="btn btn-type-1"><i class="fa fa-search"></i></div>',"<div>"+c.content+"</div>","</a>","</div>"]):d.concat(["<div>",'<a class="btn btn-type-1" href="'+c.href+'" target="'+(c.target||"_self")+'"><i class="fa fa-search"></i></a>',"</div>"]),d.push("</div>"),b.append(d.join(""))}),b.on("mouseleave",function(){b.find(".image-link-mask").remove()})}}}]).directive("unreadMessageCounter",["Message","$filter","$modal",function(a,b,c){return{transclude:!1,restrict:"C",replace:!1,link:function(b,d,e,f){a.getUnReadCount().success(function(a){return 0!=a.status?void c({title:"Error Info",content:"获取未读信息数失败！",show:!0}):void(b.counter=a.data)})}}}]).directive("topButton",["$anchorScroll",function(a){return{transclude:!1,restrict:"C",replace:!0,link:function(b,c,d,e){c.attr("id","top-target");var f=['<aside ng-show="showTopButton" class="aside-action">','<button class="back-to-top">','<span class="glyphicon glyphicon-triangle-top"></span><br/>',"<span>TOP</span>","</button>","</aside>"].join(""),g=$(f);c.append(g),angular.element(window).on("scroll",function(){g.toggle(angular.element(this).scrollTop()>500)}),g.find(".back-to-top").on("click",function(){a("top-target")})}}}]);