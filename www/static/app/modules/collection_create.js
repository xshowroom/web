/*! xshowroom - v1.0.0 - 2016-01-15 */angular.module("xShowroom.collection.create",["xShowroom.i18n","xShowroom.directives","xShowroom.services","mgcrea.ngStrap","ngTextcomplete"]).controller("CollectionCreateCtrl",["$scope","$q","$modal","$filter","Collection",function(a,b,c,d,e){a.collection={},a.checkInfo={validation:{name:!1,category:!1,mode:!1,season:!1,order:!1,currency:!1,deadline:!1,delivery:!1,description:!1,image:!1},reg:{order:/^\d+$/,deadline:/\d{4}-\d{2}-\d{2}/,delivery:/\d{4}-\d{2}-\d{2}/},duplication:["name"]},a.create=function(){a.errorMsgs=[];var f=[];for(var g in a.checkInfo.validation){var h=a.collection[g];"deadline"!=g&&"delivery"!=g||h?h&&""!=h?!a.checkInfo.reg[g]||a.checkInfo.reg[g].test(h)?(a.checkInfo.duplication.indexOf(g)>=0&&f.push(e.duplicationCheck({key:g,param:h})),a.checkInfo.validation[g]=!1):(a.errorMsgs.push([g,"PATTERN_ERROR"]),a.checkInfo.validation[g]=!0):(a.errorMsgs.push([g,"EMPTY_ERROR"]),a.checkInfo.validation[g]=!0):(a.errorMsgs.push([g,"DATE_ERROR"]),a.checkInfo.validation[g]=!0)}b.all(f).then(function(){for(var b=0;b<arguments[0].length;b++){var f=arguments[0][b],g=f.config.data.key;f.data.status?(a.checkInfo.validation[g]=!0,a.errorMsgs.push([g,"DUPLICATION_ERROR"])):a.checkInfo.validation[g]=!1}a.errorMsgs.length||e.create(a.collection).success(function(a){"object"!=typeof a||a.status?c({title:d("translate")("modal__title__ERROR"),content:a.msg,show:!0}):window.open("/collection/"+a.data,"_self")})})},a.setDatesByMode=function(b){if("dropdown__COLLECTION_MODE__PERMANENT"==b){var c=(new Date).getFullYear(),e=new Date;e.setYear(c+100),a.collection.delivery=d("date")(e,"yyyy-MM-dd"),a.collection.deadline=d("date")(e,"yyyy-MM-dd")}else a.collection.delivery=null,a.collection.deadline=null}}]);