/*! xshowroom - v1.0.0 - 2016-01-15 */angular.module("xShowroom.register.brand",["xShowroom.i18n","xShowroom.directives","xShowroom.services"]).controller("RegisterBrandCtrl",["$scope","$element","$timeout","$modal","$filter","$q","User","Country",function(a,b,c,d,e,f,g,h){a.step={stepNumber:1,validation:{1:{email:!1,pass:!1,firstName:!1,lastName:!1,displayName:!1,tel:!1},2:{brandName:!1,designerName:!1,imagePath:!1,brandUrl:!1,categoryType:!1},3:{companyName:!1,companyAddr:!1,companyCountry:!1,companyZip:!1,companyTel:!1,companyWebsite:!1,acceptCondition:!1}},reg:{1:{email:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,pass:/^\S{6,100}$/,firstName:/^\S{1,50}$/,lastName:/^\S{1,50}$/},2:{brandUrl:/^[0-9a-zA-Z]+$/},3:{companyWebsite:/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-@?^=%&amp;/~\+#])?/}},duplication:{1:["email"],2:["brandName","brandUrl"],3:[]}},a.user={roleType:1},a.setCollection=function(b){var c=a.user.categoryType?a.user.categoryType.split(","):[],d=c.indexOf(b);d>=0?c.splice(d,1):c.push(b),a.user.categoryType=c.join(",")},a.isRegistering=!1,a.check=function(){var b=a.step.stepNumber,c=a.step.validation[b];a.errorMsgs=[];var d=[];for(var e in c){var h=a.user[e];h&&""!=h?!a.step.reg[b][e]||a.step.reg[b][e].test(h)?(a.step.duplication[b].indexOf(e)>=0&&d.push(g.duplicationCheck({key:e,param:h})),a.step.validation[b][e]=!1):(a.errorMsgs.push([e,"PATTERN_ERROR"]),a.step.validation[b][e]=!0):(a.errorMsgs.push([e,"EMPTY_ERROR"]),a.step.validation[b][e]=!0)}f.all(d).then(function(){for(var c=0;c<arguments[0].length;c++){var d=arguments[0][c],e=d.config.data.key;d.data.status?(a.step.validation[b][e]=!0,a.errorMsgs.push([e,"DUPLICATION_ERROR"])):a.step.validation[b][e]=!1}!a.errorMsgs.length&&a.step.stepNumber<3?a.step.stepNumber+=1:a.errorMsgs.length||3!=a.step.stepNumber||a.register()})},a.previous=function(){a.step.stepNumber>1&&a.step.stepNumber<=3&&a.step.stepNumber--},a.countries=h.getAll(),a.register=function(){if(!a.isRegistering){a.isRegistering=!0;var b=g.register(a.user);b.success(function(b){a.isRegistering=!1,"object"!=typeof b||b.status?d({title:e("translate")("modal__title__ERROR"),content:b.msg,show:!0}):window.open("/brand/dashboard","_self")})}},a.checkInvitation=function(){var a=angular.element("#invitation-code").val();g.invitationCheck({code:a,rnd:(new Date).getTime()}).success(function(a){a.status?$("#invite-modal").modal("hide"):$("#invite-error").show()})}}]);